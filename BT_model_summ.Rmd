---
title: "The evolution of social effects in breeding time"
author: "Andres Qui√±ones"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
documentclass: extarticle
bibliography: time2breed.bib
fontsize: 12pt
linespread: 2
header-includes:
   - \linespread{2}
   - \usepackage{lineno}
   - \linenumbers
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library("here")
source(here("..","R_files","posPlots.r"))
source(here("AccFunc.r"))
source(here("Aesth.r"))
library("data.table")
library("circular")
library("ggplot2")
library("cowplot")
```


## Justification

In natural populations, reproductive success depends on the availability of the 
resources necessary for reproduction. Resources typically vary in space and time.
Predicting the abundance of resources can be extremely important for organisms, particularly 
for those that need time to prepare for a reproductive event. The spatial and 
temporal variation in resource availability can be, to some extent, 
predicted through environemental cues. For example, resource availability in the 
temperate zones varies temporally with the seasons. Thus, 
resource availability can be predicted by environmental cues that vary periodically 
along the year, for instance photoperiod. Thus, in order to match, the physiological 
processes required for reproduction with high abundance of resources, it makes sense for 
organisms to use environmental correlates of resource abundance in their 
reproductive desicions. 

This correlation between resource abundance and environmental
cues is, however, not perfect. This means that, if individuals use environmental cues 
to decide when to reproduce, on certain occassions the cues will provide erroneous information, 
leading to a mismatch between reproduction and resource abundance. Furthermore, one expects 
a certain level of error in the perception of environmental cues by individuals. 
In order to reduce the mismatch, particularly generated by the perception error, 
individuals could include the reproductive desicion of their peers into their 
decision making process. This desicion making strategy could, however, come with 
some trade offs. One potencial cost is, if all individuals respond to the social influence,
breeding time might end up being overly concentrated in time. The excessive cooprdination in breeding,
due to density dependence, might reduce the reproductive success. 
Thus, depending on the strength of the intra-specific competition, it might be 
better for individuals to respond less to their peers. 

The question of breeding time in a sexual population has some interesting complications.
The balance between information aquisition and intra-specific competition described
above applies to females only. For whom resources for offspring provisioning is of 
outmost importance. For males however, it's more important to find mates. Thus, 
environmental information is useful for males only as a proxy of female availability. 
Perhaps, the social influence is a more direct cue of the availability of reproductive 
females. This does not mean that males do not experience density dependence effects. 
If a male happens to be reproductively active when abunduce of females is low, but 
abundance of reproductively active males even lower, such male might enjoy a high 
reproductice success. Which opens up the question, what is the best strategy for a 
male to decide when to become reproductively active?

## The model

In order to assess the effect that natural selection could have
on the evolution of the desicion making mechanisms, we develop an evolutionary model. 
In the model, we let individuals evolve the sensitivity to include in their decision 
making process of when to breed the reproductive status of their conspecifics. 
We start with an asexual population. Individuals can use an environmental cue to decide when, 
during the year, to breed. This environmental cue is partly correlated with the abundance of 
resources along the season. Specifically, we let the mean abundance of resources 
along the year be a random variable determined by the Von Mises distribution [@mardia_directional_1999], 
which is a circular analogue of the normal distribution. By using the Von Mises distribution, 
we assume that resources have one peak of abundance during the year. Also, by tuning 
parameters $\kappa$ and $\mu$ in the distribution, we can control how high and spread 
is the peak of resources, respectively. The actual abundance of resource in a given time point 
of the year, will be a random variable drawn from a normal distribution with mean equal to the
draw of the Von Mises distribution, and a standard deviation given by the parameter $\sigma$. 
In figure \ref{fig:resDistr}, we show the probalility distribution of the amount of 
resources along the year, given by the two probability distributions mentioned earlier. 

```{r fig1,echo=FALSE,warning=FALSE, fig.cap="\\label{fig:resDistr} Resource distribution along the year. A shows the probability distribution. B shows an example of the correlation of resources and environmental cue."}

# Time intervals
nYearInt<-48
timeRang<-as.circular(seq(0,2*pi,length.out = nYearInt))
resorRange<-seq(0,1,length.out = nYearInt)

# Resource range

resorRange<-seq(0,1,length.out = nYearInt)

contourData<-do.call(rbind,lapply(timeRang,FUN = dresourDist,
                                  resource=resorRange,scalar=2,sigma=0.1,
                                  kappa=1))
par(plt=posPlot())
resDist<-~filled.contour(
  x = as.numeric(timeRang),
  y = resorRange,
  z = contourData,
  plot.axes = {
    axis(1,
         at = seq(0, 2 * pi, length.out = 5)[1:4],
         labels=seasons,cex.axis=0.8,las=2)
    axis(2, at = seq(0, 1, length.out = 5))
  },
  key.axes = axis(4,cex=0.5))
randResour <-
  sapply(
    as.circular(seq(0, 2 * pi, length.out = 12)),
    rresourDist,
    scalar = 1,
    sigma = 0.1,
    kappa = 1
  )
oneSample<-data.table(randResour,time=as.circular(seq(0,2*pi,length.out = 12)))
oneSample$EnvCue<-EnvCue(oneSample$randResour,sigma = 0.1)
oneSample$month<-c("January","February","March","April","May","June","July",
                   "August","September","October","November","December")
oneSample[,month:=as.factor(month)]
oneSample[,time:=NULL]

longOneSample<-melt(oneSample,id.vars = "month",
                    variable.name = "Measure")
longOneSample[,month:=as.circular(seq(0,2*pi,length.out = 12))[month]]
seasAng <- as.circular(seq(0,2*pi,length.out = 5))[1:4]
seasAng<-seasAng+rep((seasAng[2])/2,4)

sampleResCue<-ggplot(longOneSample, aes(x = month, y = value, fill=Measure)) +
  geom_col(position = "dodge") +
  scale_fill_manual(values=c("#999999", "#E69F00"),
                    name = "", labels = c("Res. abundance","Env. cue"))+ 
    coord_polar() + 
  theme_minimal() +
  theme(
    axis.text.x = element_blank() ,
    axis.title = element_blank(),
    #panel.grid = element_blank(),
    plot.margin = unit(rep(0.5,4), "cm"),
    legend.position="top"
    
  ) +
  annotate(geom="text", x=seasAng, y=max(longOneSample$value), label=seasons,
           color="red")

plot_grid(resDist, sampleResCue,rel_widths = c(1.5,1), labels = c("A", "B"))  


```

The environmentl cue
The perception of the environmental cue by each individual 
is prone to errors. So, the mismatch between the perceived cue, and the resource 
variation not predicted by the environmental cue, could potentially trigger individual
breeding at the wrong time. Hence, individuals could improve their decision making by 
taking into account the breeding status of their peers, which could potentially 
improve the accuracy of their decision by pulling together individual and social information. 

	 


We aim to answer the above questions using a individual based model. In such model,
individuals have genotypes that define their response to an environmental cue, as well 
as the reproductive status of other individuals. The decision of whether to breed at a particular  time is given the log odds equation from a logistic regression

\begin{equation}
	log\frac{p}{1-p}=\beta_0+e \beta_e+s \beta_s+
\end{equation}
